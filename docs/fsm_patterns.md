---

# üß© FSM Patterns

**–®–∞–±–ª–æ–Ω—ã –¥–ª—è —Ñ–æ—Ä–º, –æ–ø—Ä–æ—Å–æ–≤ –∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.**  
–≠—Ç–∞ –≥–ª–∞–≤–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω–µ—á–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç—ã (FSM) –¥–ª—è –ø–æ—à–∞–≥–æ–≤—ã—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π: –æ—Ç –ø—Ä–æ—Å—Ç—ã—Ö —Ñ–æ—Ä–º –¥–æ –≤–µ—Ç–≤—è—â–∏—Ö—Å—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.

---

## üìã –§–æ—Ä–º—ã: –ª–∏–Ω–µ–π–Ω—ã–π –≤–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö

```python
class FormFSM:
    def __init__(self):
        self.state = "start"
        self.data = {}

    def handle(self, event):
        match (self.state, event.type):
            case ("start", "input_name"):
                self.data["name"] = event.payload
                self.state = "awaiting_email"
                return "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à email:"
            case ("awaiting_email", "input_email"):
                self.data["email"] = event.payload
                self.state = "done"
                return f"–°–ø–∞—Å–∏–±–æ, {self.data['name']}! –ú—ã –æ—Ç–ø—Ä–∞–≤–∏–º –ø–∏—Å—å–º–æ –Ω–∞ {self.data['email']}."
            case _:
                return "–ù–µ –ø–æ–Ω–∏–º–∞—é, –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –≤–≤–æ–¥."
```

### üß† –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏–¥–µ–∏

- `self.data`: –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ FSM-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ.
- `state = "done"`: —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ‚Äî —É–¥–æ–±–Ω–æ –¥–ª—è —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ (–æ—Ç–ø—Ä–∞–≤–∫–∞, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ).
- –†–∞—Å—à–∏—Ä—è–µ–º–æ: –¥–æ–±–∞–≤—å –ø–æ–ª—è, –≤–∞–ª–∏–¥–∞—Ü–∏—é, —Ç–∞–π–º–∞—É—Ç—ã.

---

## üìä –û–ø—Ä–æ—Å—ã: –ø–æ—à–∞–≥–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã

```python
class SurveyFSM:
    def __init__(self):
        self.state = "q1"
        self.answers = {}

    def handle(self, event):
        match (self.state, event.type):
            case ("q1", "answer"):
                self.answers["q1"] = event.payload
                self.state = "q2"
                return "–í–æ–ø—Ä–æ—Å 2: –ö–∞–∫ —á–∞—Å—Ç–æ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –Ω–∞—à –ø—Ä–æ–¥—É–∫—Ç?"
            case ("q2", "answer"):
                self.answers["q2"] = event.payload
                self.state = "done"
                return "–°–ø–∞—Å–∏–±–æ –∑–∞ —É—á–∞—Å—Ç–∏–µ!"
```

### üß† –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏–¥–µ–∏

- FSM –∫–∞–∫ –ª–∏–Ω–µ–π–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞: `q1 ‚Üí q2 ‚Üí done`
- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å `q3`, `q4`, –∏–ª–∏ –≤–µ—Ç–≤–ª–µ–Ω–∏–µ –ø–æ –æ—Ç–≤–µ—Ç–∞–º
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è NPS, UX-–æ–ø—Ä–æ—Å–æ–≤, —Å–±–æ—Ä–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏

---

## üß¨ –°—Ü–µ–Ω–∞—Ä–∏–∏: –≤–µ—Ç–≤–ª–µ–Ω–∏–µ –ø–æ –≤—ã–±–æ—Ä—É

```python
class ScenarioFSM:
    def __init__(self):
        self.state = "intro"

    def handle(self, event):
        match (self.state, event.type):
            case ("intro", "choose_path"):
                if event.payload == "A":
                    self.state = "path_a"
                    return "–í—ã –≤—ã–±—Ä–∞–ª–∏ –ø—É—Ç—å A. –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º..."
                elif event.payload == "B":
                    self.state = "path_b"
                    return "–í—ã –≤—ã–±—Ä–∞–ª–∏ –ø—É—Ç—å B. –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥..."
            case ("path_a", "continue"):
                return "–í—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ –ø—É—Ç—å A!"
            case ("path_b", "continue"):
                return "–í—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ –ø—É—Ç—å B!"
```

### üß† –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏–¥–µ–∏

- FSM –∫–∞–∫ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –æ–±—É—á–µ–Ω–∏—è, –∫–≤–µ—Å—Ç–æ–≤, —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ç–∞–π–º–µ—Ä—ã, —É—Å–ª–æ–≤–∏—è, –≤–æ–∑–≤—Ä–∞—Ç—ã

---

## üß™ –¢–µ—Å—Ç-–≥–∞–π–¥: –æ–±—É—á–∞—é—â–∏–µ –≥–ª–∞–≤—ã

```python
def test_form_fsm_flow():
    fsm = FormFSM()
    assert fsm.handle(Event("input_name", "–ê–ª–∏—Å–∞")) == "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à email:"
    assert fsm.handle(Event("input_email", "alice@example.com")) == "–°–ø–∞—Å–∏–±–æ, –ê–ª–∏—Å–∞! –ú—ã –æ—Ç–ø—Ä–∞–≤–∏–º –ø–∏—Å—å–º–æ –Ω–∞ alice@example.com."
    assert fsm.state == "done"
```

### üìö –ü–∞—Ç—Ç–µ—Ä–Ω: –∫–∞–∂–¥—ã–π —Ç–µ—Å—Ç ‚Äî —ç—Ç–æ –º–∏–Ω–∏-–≥–ª–∞–≤–∞

- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ‚Üí —Å–æ–±—ã—Ç–∏–µ ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ ‚Üí —Ñ–∏–Ω–∞–ª
- –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞ = –∑–∞–≥–æ–ª–æ–≤–æ–∫ walkthrough
- –î–æ–±–∞–≤—å –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏, —á—Ç–æ–±—ã —Ç–µ—Å—Ç —Å—Ç–∞–ª –æ–±—É—á–∞—é—â–∏–º –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–º

---